# Firestore Security Rules for Matrimony App
# Copy these rules to Firebase Console → Firestore → Rules

rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Users collection - allow authenticated users to read all profiles, write their own
    match /users/{uid} {
      allow read: if request.auth != null;
      allow write: if request.auth != null && request.auth.uid == uid;
    }
    
    // Profiles collection - allow authenticated users to read all profiles, write their own
    match /profiles/{uid} {
      allow read: if request.auth != null;
      allow write: if request.auth != null && request.auth.uid == uid;
    }
    
    // Activities collection - allow authenticated users to read/write activities
    match /activities/{doc} {
      allow read, write: if request.auth != null;
    }
    
    // Notifications collection - allow users to read their own notifications, write to create notifications
    match /notifications/{doc} {
      allow read: if request.auth != null && request.auth.uid == resource.data.recipientId;
      allow create: if request.auth != null;
    }
    
    // Matches collection - allow users to read/write their own matches
    match /matches/{doc} {
      allow read, write: if request.auth != null && 
        (request.auth.uid == resource.data.user1Id || request.auth.uid == resource.data.user2Id);
      allow create: if request.auth != null;
    }
    
    // Chat rooms collection - allow users to read/write messages in their chat rooms
    match /chat_rooms/{roomId}/messages/{messageId} {
      allow read, write: if request.auth != null && 
        (request.auth.uid == resource.data.senderId || request.auth.uid == resource.data.receiverId);
      allow create: if request.auth != null;
    }
  }
}
